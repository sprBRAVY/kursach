@model PrintingOrderManager.Core.DTOs.OrderDto

@{
    ViewData["Title"] = "Детали заказа";
}

<h1>Детали заказа</h1>

<div>
    <h4>Основная информация</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">ID заказа</dt>
        <dd class="col-sm-10">@Html.DisplayFor(model => model.OrderId)</dd>

        <dt class="col-sm-2">Клиент</dt>
        <dd class="col-sm-10">@Html.DisplayFor(model => model.ClientName)</dd>

        <dt class="col-sm-2">Дата размещения</dt>
        <dd class="col-sm-10">@Html.DisplayFor(model => model.PlacementDate)</dd>

        <dt class="col-sm-2">Дата завершения</dt>
        <dd class="col-sm-10">@Html.DisplayFor(model => model.CompletionDate)</dd>

        <dt class="col-sm-2">Статус заказа</dt>
        <dd class="col-sm-10">
            <span class="badge bg-@(Model.Status == "Выполнен" ? "success" : Model.Status == "В процессе" ? "warning" : "secondary")">
                @Model.Status
            </span>
        </dd>

        <div class="row mb-3">
            <div class="col-md-6">
                <strong>Общая стоимость:</strong> @Model.TotalCost.ToString("C")
            </div>
            <div class="col-md-6">
                <strong>Оплачено:</strong> @Model.PaidAmount.ToString("C")
            </div>
        </div>

        @if (Model.IsPaid)
        {
            <div class="alert alert-success">
                <strong>✅ Заказ полностью оплачен</strong>
            </div>
        }
        else
        {
            <div class="alert alert-warning">
                <strong>⚠️ Осталось оплатить: @(Model.TotalCost - Model.PaidAmount).ToString("C")</strong>
            </div>
        }
    </dl>
</div>

<div>
    <h4>Элементы заказа</h4>
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>Услуга</th>
                <th>Работник</th>
                <th>Оборудование</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model.OrderItems)
            {
                <tr>
                    <td>@item.ServiceName</td>
                    <td>@item.WorkerFullName</td>
                    <td>@item.EquipmentName</td>
                    <td>
                        <span class="badge bg-@(item.Status == "Готово" ? "success" : item.Status == "В работе" ? "warning" : "secondary")">
                            @item.Status
                        </span>
                    </td>
                    <td>
                        @if (User.IsInRole("Admin"))
                        {
                            @if (item.Status == "Ожидает")
                            {
                                <a asp-action="StartWork" asp-controller="OrderItems" asp-route-id="@item.ItemId" asp-route-orderId="@Model.OrderId" class="btn btn-sm btn-warning">Начать</a>
                            }
                            else if (item.Status == "В работе")
                            {
                                <a asp-action="CompleteWork" asp-controller="OrderItems" asp-route-id="@item.ItemId" asp-route-orderId="@Model.OrderId" class="btn btn-sm btn-success">Завершить</a>
                            }
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div>
    <h4>Платежи</h4>
    <table class="table table-hover">
        <thead class="table-light">
            <tr>
                <th>Сумма</th>
                <th>Дата</th>
                <th>Статус</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var payment in Model.Payments)
            {
                <tr>
                    <td>@payment.Amount</td>
                    <td>@payment.PaymentDate</td>
                    <td>@payment.PaymentStatus</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<div class="mt-3">
    <a asp-action="Edit" asp-route-id="@Model?.OrderId" class="btn btn-primary">Редактировать</a> |
    <a asp-action="Index" class="btn btn-secondary">Вернуться к списку</a>
</div>